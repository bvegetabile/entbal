---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  echo = T,
  width = 90,
  comment = "#>",
  fig.path = "README-"
)
options(width = 100)
```

# entbal - An alternative implementation of entropy balancing weights

The goal of entbal is to create an easy to use implementation of the entropy balancing algorithm outlined in Hainmueller (2012) for applied researchers to use.  

Hainmueller, Jens. "Entropy balancing for causal effects: A multivariate reweighting method to produce balanced samples in observational studies." Political Analysis 20.1 (2012): 25-46.

## Installation

You can install entbal from github with:

```{r gh-installation, eval = FALSE}
# install.packages("devtools")
devtools::install_github("bvegetabile/entbal")
```

## Example of Estimating Entropy Balancing Weights

This is a basic example that shows how to obtain weights on a simple dataset from Dehejia and Wahba (1999).  

Dehejia, Rajeev H., and Sadek Wahba. "Causal effects in nonexperimental studies: Reevaluating the evaluation of training programs." Journal of the American statistical Association 94.448 (1999): 1053-1062.

In the dataset the goal is estimating postintervention earnings after inclusion into a job training program.  The variables *age*, *education*, *black*, *hispanic*, *married*, *nodegree*, *RE74*, and *RE75*, all represent pre-exposure variables.  The variables *RE74*, *RE75*, represent "retrospective earnings" in 1974  and 1975 respectively.  The variable *RE78* represents the outcomes of earnings in 1978.  Finally, the variable *TA* represents the indicator of inclusion in the treatment program.  

The original DW99 paper contains six control datasets.  The example below uses a control group from the Current Population Survey (CPS1) and is the largest dataset examined in DW99.  

```{r example}
library(entbal)
library(survey, quietly = T, warn.conflicts = F, verbose = F)
dset <- dw99cps1
estwts <- entbal(TA ~ age + education + black + hispanic + married + nodegree + RE74 + RE75,
                 data = dset,
                 n_moments = 3,
                 verbose = 1,
                 estimand = "ATT")
summary(estwts)
```

### Outcome Modeling

To estimate the effect of the job training program on postintervention earnings we can use the survey package to estimate the effect of treatment.   

```{r example2}
dset$wts <- estwts$wts
design <- svydesign(ids=~1, weights=~wts, data = dset)
resp <- svyglm(RE78 ~ TA,
               design = design)
summary(resp)
```


We see that the estimating difference in the post-intervention earnings is approximately $1392.  An additional analysis could controlling for additional variables, as follows:

```{r example3}
resp <- svyglm(RE78 ~ TA + age + education + black + hispanic + married + nodegree + RE74 + RE75,
               design = design)
summary(resp)
```

We see that the results do not change much and that our point estimate is the same.
